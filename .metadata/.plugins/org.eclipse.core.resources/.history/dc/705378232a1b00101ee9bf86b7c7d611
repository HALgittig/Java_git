package LogAnalysis_Jenkins;

import java.io.File;
import java.io.IOException;

public class Main {
    public static void main(String[] args) {
        if (args.length < 1) {
            System.out.println("â— ãƒ­ã‚°ãƒ•ã‚©ãƒ«ãƒ€ã®ãƒ‘ã‚¹ã‚’å¼•æ•°ã§æŒ‡å®šã—ã¦ãã ã•ã„ã€‚");
            System.out.println("ä¾‹: java -cp src Main C:\\logs");
            return;
        }

        File logDir = new File(args[0]);
        if (!logDir.exists() || !logDir.isDirectory()) {
            System.err.println("âŒ æŒ‡å®šã•ã‚ŒãŸãƒ‘ã‚¹ã¯å­˜åœ¨ã—ãªã„ã‹ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ã¯ã‚ã‚Šã¾ã›ã‚“: " + logDir.getAbsolutePath());
            return;
        }

        String webhookUrl = "https://discord.com/api/webhooks/1361910822225449070/gqw9y635H_jCcX4RhVyjj8iwMlRnIirqrr8TnHiR5K_Q2rIeJYePzjNv3QuF9EUPYUhl"; // ã‚ãªãŸã®Webhook URLã«ç½®ãæ›ãˆã¦ãã ã•ã„

        File[] logFiles = logDir.listFiles((dir, name) -> name.endsWith(".txt") || name.endsWith(".log"));
        if (logFiles == null || logFiles.length == 0) {
            System.out.println("ğŸ“­ å‡¦ç†å¯¾è±¡ã®ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚");
            return;
        }

        for (File logFile : logFiles) {
            System.out.println("ğŸ” è§£æä¸­: " + logFile.getName());
            File outputFile = new File(logDir, "summary_" + logFile.getName());

            JenkinsLogAnalyzer analyzer = new JenkinsLogAnalyzer();
            try {
                analyzer.analyzeLog(logFile);
                analyzer.writeSummary(outputFile);
                DiscordWebhookSender.sendFileToDiscord(webhookUrl, outputFile);
                System.out.println("âœ… " + logFile.getName() + " â†’ é€ä¿¡å®Œäº†");
            } catch (IOException e) {
                System.err.println("âŒ ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: " + logFile.getName());
                e.printStackTrace();
            }
        }

        System.out.println("ğŸ‰ å…¨ã¦ã®ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®å‡¦ç†ãŒå®Œäº†ã—ã¾ã—ãŸï¼");
    }
}

